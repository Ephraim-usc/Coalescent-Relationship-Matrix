#!/usr/bin/env python

### importing packages
import argparse
import math

### importing egrm
from egrm import mTMRCA, mTMRCA_C, read_trees, write_grm

### parse arguments
parser=argparse.ArgumentParser()
parser.add_argument('--input', type = str, help='input file prefix')
parser.add_argument('--output', type = str, help='output file prefix')
parser.add_argument('--c', help='acceleration by C extension', action='store_true')

args = vars(parser.parse_args())
args = dict((k,v) for k,v in args.items() if v is not None)

input = args["input"]

if args.get("output", None) == None:
  output = input + ".e"
else:
  output = args["output"]

c_extension = args.pop("c")

### 
trees = read_trees(input + ".trees")

if c_extension == True:
  mtmrca, mtmrca_l = mTMRCA_C(trees, file = None)
if c_extension == False:
  mtmrca, mtmrca_l = mTMRCA(trees)

write_grm(mtmrca, mtmrca_l, output, format = "pickle")
